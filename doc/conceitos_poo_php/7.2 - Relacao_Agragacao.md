## Defini√ß√£o formal (engenharia de software)

Agrega√ß√£o √© uma rela√ß√£o todo‚Äìparte fraca, onde:

- Existe rela√ß√£o ‚Äútem um‚Äù

- As partes podem existir independentemente

- O todo n√£o controla o ciclo de vida das partes

- As partes podem ser compartilhadas

- A destrui√ß√£o do todo n√£o destr√≥i as partes

Formalmente:

- Existe agrega√ß√£o quando A ‚Äútem‚Äù B,
- mas B n√£o depende existencialmente de A.

## Posi√ß√£o acad√™mica importante (ponto cr√≠tico)

Em engenharia moderna, especialmente:

- Clean Architecture

- DDD

- SOLID

üëâ Agrega√ß√£o N√ÉO √© implementada como algo distinto da associa√ß√£o no c√≥digo.

Ela √© uma decis√£o sem√¢ntica de modelagem, n√£o um mecanismo t√©cnico.

üìå UML diferencia:

- Associa√ß√£o

- Agrega√ß√£o (losango vazio)

- Composi√ß√£o (losango cheio)

üìå C√≥digo N√ÉO diferencia associa√ß√£o de agrega√ß√£o

## Compara√ß√£o cient√≠fica direta: 

| Crit√©rio            | Associa√ß√£o | Agrega√ß√£o        | Composi√ß√£o       |
| ------------------- | ---------- | ---------------- | ---------------- |
| Tipo                | Gen√©rica   | Todo‚Äìparte fraca | Todo‚Äìparte forte |
| Depend√™ncia de vida | ‚ùå          | ‚ùå                | ‚úÖ                |
| Cria√ß√£o interna     | ‚ùå          | ‚ùå                | ‚úÖ                |
| Compartilh√°vel      | ‚úÖ          | ‚úÖ                | ‚ùå                |
| ‚Äú√â parte de‚Äù        | ‚ùå          | ‚úÖ                | ‚úÖ                |
| Controle do todo    | ‚ùå          | Parcial          | Total            |

## Agrega√ß√£o vs Associa√ß√£o (diferen√ßa real)

Essa √© a pergunta mais importante:

- Se agrega√ß√£o e associa√ß√£o usam o mesmo c√≥digo, por que agrega√ß√£o existe?

Resposta:

- üëâ Para expressar significado de dom√≠nio, n√£o t√©cnica.

## Exemplo conceitual cl√°ssico

Universidade e Professor

- Universidade tem professores

- Professor n√£o pertence √† universidade

- Professor pode trocar de universidade

- Professor existe sem universidade

üëâ Agrega√ß√£o

## Exemplo de Agrega√ß√£o em PHP:

```php
class Professor
{
    public function __construct(
        private string $nome
    ) {}
}

class Universidade
{
    /** @var Professor[] */
    private array $professores;

    public function __construct(array $professores)
    {
        $this->professores = $professores;
    }
}
```

An√°lise cient√≠fica

- Universidade n√£o cria Professor

- Recebe inst√¢ncias prontas

- Professores podem ser reutilizados

- N√£o h√° controle de vida

üëâ Agrega√ß√£o leg√≠tima

## Agrega√ß√£o N√ÉO √â ‚Äúarray de objetos‚Äù

Isso √© um erro conceitual comum.

```php
class Pedido {
    private array $itens;
}
```

Isso n√£o define agrega√ß√£o.

A decis√£o est√° no significado:

- Quem criou?

- Quem destr√≥i?

- Pode existir fora?

## Agrega√ß√£o no mundo real (casos leg√≠timos)

Exemplos corretos:

- Time ‚Üí Jogadores

- Empresa ‚Üí Funcion√°rios

- Curso ‚Üí Alunos

- Biblioteca ‚Üí Livros

- Pedido ‚Üí Produto (produto ‚â† item)

üìå Observe:

- Produto existe fora do pedido

- Pedido apenas referencia

## Compara√ß√£o: Agrega√ß√£o vs Composi√ß√£o (caso sutil)

Pedido + Produto (agrega√ß√£o)

```php
class Pedido {
    private array $produtos;
}
```

Pedido + ItemPedido (composi√ß√£o)

```php
class Pedido {
    private array $itens;
}
```

- Produto √© agregado

- ItemPedido √© composto

Esse √© um padr√£o cl√°ssico de sistemas comerciais

## Regra de ouro definitiva

Fa√ßa estas perguntas:

- Isso √© parte estrutural?

- Pode existir sozinho?

- Pode ser compartilhado?

- Quem controla o ciclo de vida?

Resultado:

- Sim / Sim / Sim / Externo ‚Üí Agrega√ß√£o

- N√£o / Sim / Sim / Externo ‚Üí Associa√ß√£o

- N√£o / N√£o / N√£o / Interno ‚Üí Composi√ß√£o